
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Zombie Battle</title>

<style>
html,body{
 margin:0;
 padding:0;
 overflow:hidden;
 background:black;
 touch-action:none;
}
canvas{display:block}

#joystick{
 position:fixed;
 left:20px;
 bottom:40px;
 width:140px;
 height:140px;
 background:rgba(0,255,0,0.25);
 border-radius:50%;
}
#stick{
 width:60px;height:60px;
 background:#00ff88;
 border-radius:50%;
 position:absolute;
 left:40px;top:40px;
}
#fire{
 position:fixed;
 right:30px;
 bottom:60px;
 width:90px;height:90px;
 border-radius:50%;
 background:red;
 color:white;
 font-size:30px;
 border:none;
}
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="joystick"><div id="stick"></div></div>
<button id="fire">ðŸ”¥</button>

<audio id="bgm" src="bg.mp3" loop></audio>
<audio id="fireS" src="fire.mp3"></audio>
<audio id="hitS" src="hit.mp3"></audio>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

/* Images */
const bg=new Image(); bg.src="bg.png";
const playerImg=new Image(); playerImg.src="player.png";
const zombieImg=new Image(); zombieImg.src="zombie.png";
const bossImg=new Image(); bossImg.src="boss.png";
const bulletImg=new Image(); bulletImg.src="bullet.png";

/* Sounds */
bgm.volume=0.4; bgm.play();

/* CAMERA */
let cameraX=0;

/* PLAYER (fixed X) */
let player={
 x:canvas.width/3,
 y:canvas.height-200,
 w:80,h:80,
 speed:4
};

/* Objects */
let zombies=[];
let bullets=[];
let boss=null;

/* JOYSTICK */
let joyX=0,joyY=0,active=false;
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");

joy.addEventListener("touchstart",()=>active=true);
joy.addEventListener("touchend",()=>{
 active=false; joyX=joyY=0;
 stick.style.left="40px";stick.style.top="40px";
});
joy.addEventListener("touchmove",e=>{
 e.preventDefault();
 let r=joy.getBoundingClientRect();
 let x=e.touches[0].clientX-r.left-70;
 let y=e.touches[0].clientY-r.top-70;
 let d=Math.min(40,Math.hypot(x,y));
 let a=Math.atan2(y,x);
 joyX=Math.cos(a)*d;
 joyY=Math.sin(a)*d;
 stick.style.left=40+joyX+"px";
 stick.style.top=40+joyY+"px";
});

/* FIRE */
document.getElementById("fire").ontouchstart=()=>{
 fireS.currentTime=0; fireS.play();
 bullets.push({
  x:cameraX+player.x+player.w,
  y:player.y+player.h/2,
  dx:8
 });
};

/* SPAWN */
setInterval(()=>{
 zombies.push({
  x:cameraX+canvas.width+200,
  y:canvas.height-200,
  w:70,h:70,hp:2
 });
},2000);

setTimeout(()=>{
 boss={
  x:cameraX+canvas.width+400,
  y:canvas.height-240,
  w:140,h:140,hp:20
 };
},15000);

/* UPDATE */
function update(){
 /* Camera move */
 if(joyX>10) cameraX+=player.speed;

 /* Player Y only */
 player.y+=joyY*0.2;
 player.y=Math.max(100,Math.min(player.y,canvas.height-120));

 bullets.forEach(b=>b.x+=b.dx);
 zombies.forEach(z=>z.x-=1.5);
 if(boss) boss.x-=1;

 /* Collision */
 bullets.forEach((b,bi)=>{
  zombies.forEach((z,zi)=>{
   if(b.x<z.x+z.w && b.x+20>z.x && b.y<z.y+z.h){
    z.hp--; bullets.splice(bi,1);
    hitS.play();
    if(z.hp<=0) zombies.splice(zi,1);
   }
  });
  if(boss && b.x<boss.x+boss.w && b.y<boss.y+boss.h){
   boss.hp--; bullets.splice(bi,1);
   hitS.play();
   if(boss.hp<=0) boss=null;
  }
 });
}

/* DRAW */
function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 ctx.drawImage(bg,-cameraX%canvas.width,0,canvas.width,canvas.height);
 ctx.drawImage(bg,canvas.width-cameraX%canvas.width,0,canvas.width,canvas.height);

 ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);

 zombies.forEach(z=>{
  ctx.drawImage(zombieImg,z.x-cameraX,z.y,z.w,z.h);
 });
 if(boss)
  ctx.drawImage(bossImg,boss.x-cameraX,boss.y,boss.w,boss.h);

 bullets.forEach(b=>{
  ctx.drawImage(bulletImg,b.x-cameraX,b.y,20,20);
 });
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>

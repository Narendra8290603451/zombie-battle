
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<title>Zombie Battle</title>

<style>
html,body{
 margin:0;
 padding:0;
 overflow:hidden;
 background:black;
 touch-action:none;
}
canvas{display:block}

/* Joystick */
#joystick{
 position:fixed;
 left:20px;
 bottom:40px;
 width:140px;
 height:140px;
 background:rgba(0,255,0,0.2);
 border-radius:50%;
}
#stick{
 width:60px;
 height:60px;
 background:#00ff88;
 border-radius:50%;
 position:absolute;
 left:40px;
 top:40px;
}

/* Fire button */
#fire{
 position:fixed;
 right:30px;
 bottom:60px;
 width:90px;
 height:90px;
 border-radius:50%;
 background:red;
 border:none;
 font-size:30px;
 color:white;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="joystick"><div id="stick"></div></div>
<button id="fire">ðŸ”¥</button>

<audio id="bgm" src="bg.mp3" loop></audio>
<audio id="fireS" src="fire.mp3"></audio>
<audio id="hitS" src="hit.mp3"></audio>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

canvas.width=innerWidth;
canvas.height=innerHeight;

/* Images */
const bg=new Image(); bg.src="bg.png";
const playerImg=new Image(); playerImg.src="player.png";
const zombieImg=new Image(); zombieImg.src="zombie.png";
const bossImg=new Image(); bossImg.src="boss.png";
const bulletImg=new Image(); bulletImg.src="bullet.png";

/* Sounds */
const bgm=document.getElementById("bgm");
const fireS=document.getElementById("fireS");
const hitS=document.getElementById("hitS");
bgm.volume=0.4;
bgm.play();

/* Player */
let player={x:200,y:canvas.height-200,w:70,h:70,speed:3};

/* Aim */
let aimX=canvas.width, aimY=canvas.height/2;

/* Zombies */
let zombies=[];
let boss=null;

/* Bullets */
let bullets=[];

/* Joystick */
let joy=document.getElementById("joystick");
let stick=document.getElementById("stick");
let joyX=0,joyY=0,active=false;

joy.addEventListener("touchstart",()=>active=true);
joy.addEventListener("touchend",()=>{
 active=false; joyX=joyY=0;
 stick.style.left="40px"; stick.style.top="40px";
});
joy.addEventListener("touchmove",e=>{
 e.preventDefault();
 let r=joy.getBoundingClientRect();
 let x=e.touches[0].clientX-r.left-70;
 let y=e.touches[0].clientY-r.top-70;
 let d=Math.min(40,Math.hypot(x,y));
 let a=Math.atan2(y,x);
 joyX=Math.cos(a)*d;
 joyY=Math.sin(a)*d;
 stick.style.left=40+joyX+"px";
 stick.style.top=40+joyY+"px";
});

/* Fire */
document.getElementById("fire").ontouchstart=()=>{
 fireS.currentTime=0; fireS.play();
 shoot();
};

/* Aim swipe */
canvas.addEventListener("touchmove",e=>{
 if(e.touches[0].clientX>innerWidth/2){
  aimX=e.touches[0].clientX;
  aimY=e.touches[0].clientY;
 }
});

/* Functions */
function shoot(){
 let dx=aimX-player.x;
 let dy=aimY-player.y;
 let l=Math.hypot(dx,dy);
 bullets.push({
  x:player.x+player.w/2,
  y:player.y+player.h/2,
  dx:dx/l*8,
  dy:dy/l*8
 });
}

function spawnZombie(){
 zombies.push({
  x:canvas.width+Math.random()*300,
  y:canvas.height-180,
  w:70,h:70,hp:2
 });
}

function spawnBoss(){
 boss={
  x:canvas.width+200,
  y:canvas.height-220,
  w:120,h:120,hp:20
 };
}

/* Loop */
setInterval(spawnZombie,2000);
setTimeout(spawnBoss,15000);

function update(){
 player.x+=joyX*0.15;
 player.y+=joyY*0.15;

 bullets.forEach(b=>{
  b.x+=b.dx;
  b.y+=b.dy;
 });

 zombies.forEach(z=>z.x-=1.5);
 if(boss) boss.x-=1;

 /* Collision */
 bullets.forEach((b,bi)=>{
  zombies.forEach((z,zi)=>{
   if(b.x<z.x+z.w&&b.x+20>z.x&&b.y<z.y+z.h&&b.y+20>z.y){
    z.hp--; bullets.splice(bi,1);
    hitS.play();
    if(z.hp<=0) zombies.splice(zi,1);
   }
  });
  if(boss && b.x<boss.x+boss.w&&b.x+20>boss.x&&b.y<boss.y+boss.h){
   boss.hp--; bullets.splice(bi,1); hitS.play();
   if(boss.hp<=0) boss=null;
  }
 });
}

function draw(){
 ctx.drawImage(bg,0,0,canvas.width,canvas.height);
 ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);
 zombies.forEach(z=>ctx.drawImage(zombieImg,z.x,z.y,z.w,z.h));
 if(boss) ctx.drawImage(bossImg,boss.x,boss.y,boss.w,boss.h);
 bullets.forEach(b=>ctx.drawImage(bulletImg,b.x,b.y,20,20));
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
  